<!doctype html>
<html>
<head>
    <!-- third party -->
    <!-- hterm -->
    <script src='../third_party/hterm/js/hterm.js'></script>
    <script src='../third_party/hterm/js/scrollport.js'></script>
    <script src='../third_party/hterm/js/terminal.js'></script>
    <script src='../third_party/hterm/js/options.js'></script>
    <script src='../third_party/hterm/js/screen.js'></script>
    <script src='../third_party/hterm/js/vt100.js'></script>
    <script src='../third_party/hterm/js/pubsub.js'></script>
    
    <!-- lm32 -->
    <script src="lm32_base.js"></script>
    <script src="lm32_bits.js"></script>
    <script src="lm32_pic.js"></script>
    <script src="lm32_cpu.js"></script>
    <script src="lm32_mmu.js"></script>
    <script src="lm32_ram.js"></script>
    <script src="lm32_sys.js"></script>
    <script src="lm32_timer.js"></script>
    <script src="lm32_pflash.js"></script>
    <script src="lm32_uart.js"></script>
    <script src="lm32_keyhandler.js"></script>

    <script>
        var lm32_boot_linux = true;
        var key_handler = lm32.keyHandler();
        var terminal;
        function lm32_boot() {
            key_handler.send_str("setenv verify 'n'\n");
            key_handler.send_str("setenv bootargs 'root=/dev/ram0 console=ttyS0,115200 ramdisk_size=4096\n");
            key_handler.send_str("bootm 0a000000 08400000\n");
        }
        function lm32_start() {
            lm32.start(lm32_boot_linux, terminal, key_handler);
        }

        function pick_uboot() {
            lm32_boot_linux = false;
        }

        function pick_linux() {
            lm32_boot_linux = true;
        }

        function start_terminal() {
            var termConf = {
                visibleColumnCount: 80,
                visibleRowCount: 25,
                fontSize: 15,
                lineHeight: 17,
                charWidth: 9,
                scrollbarWidth: 16
            };
            var div = document.getElementById("vt100Div");
            div.style.position = 'absolute';
            div.style.height = termConf.lineHeight * termConf.visibleRowCount + 'px';
            div.style.width = termConf.charWidth * termConf.visibleColumnCount +
                    termConf.scrollbarWidth + 'px';
            document.body.appendChild(div);

            terminal = new hterm.Terminal(termConf.fontSize, termConf.lineHeight);
            terminal.decorate(div);
            terminal.setCursorBlink(true);
        }
    </script>

</head>
<body>
<form id="option">
    <input type="radio" name="boot_linux" value="true" onclick="pick_linux()" checked="checked"/> Load Linux (Boots Very Slowly) <br />
    <input type="radio" name="boot_linux" value="false" onclick="pick_uboot()" /> Load U-Boot Only
</form>
<button onclick="lm32_start()">Start!</button> &nbsp; <button onclick="lm32_boot()">Boot! (Wait for U-Boot Prompt)</button>
<p>Login: root ; Password: lattice</p>
<div id="vt100Div"></div>
<script type="text/javascript">
    start_terminal();
</script>
</body>
</html>
